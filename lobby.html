<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Table Forge Lobby</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding-top: 50px;
    }
    input, select, button {
      font-size: 1rem;
      padding: 10px;
      margin: 8px;
      width: 90%;
      max-width: 300px;
      background: #222;
      color: white;
      border: none;
      border-radius: 6px;
    }
    button:hover {
      background: #444;
    }
    .room-entry {
      background: #222;
      color: white;
      border-radius: 6px;
      margin: 10px auto;
      padding: 8px;
      width: 90%;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <h1>Create or Join a Room</h1>
  <div>
    <h2>Create Room</h2>
    <label>Game:</label>
    <select id="gameSelector">
      <option value="yugioh">Yu-Gi-Oh!</option>
      <option value="digimon">Digimon</option>
      <option value="lorcana">Lorcana</option>
    </select>
    <label>Players:</label>
    <select id="playerCount">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
    <button onclick="createRoom()">Create Room</button>
  </div>

  <div>
    <h2>Available Rooms</h2>
    <div id="roomList">Loading...</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBzvVpMCdg3Y6i5vCGWarorcTmzBzjmPow",
      authDomain: "tableforge-app.firebaseapp.com",
      databaseURL: "https://tableforge-app-default-rtdb.firebaseio.com",
      projectId: "tableforge-app",
      appId: "1:708497363618:web:39da060b48681944923dfb",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Create a new room
    function createRoom() {
      const game = document.getElementById("gameSelector").value;
      const players = document.getElementById("playerCount").value;

      const roomRef = ref(db, "rooms");
      const newRoomRef = push(roomRef);

      const roomData = {
        game,
        players,
        createdAt: Date.now(),
      };

      newRoomRef.set(roomData).then(() => {
        alert("Room created successfully!");
        loadRooms();
      }).catch((error) => {
        console.error("Error creating room:", error);
      });
    }

    // Load available rooms
    function loadRooms() {
      const roomList = document.getElementById("roomList");
      roomList.innerHTML = "Loading...";

      const roomRef = ref(db, "rooms");
      onValue(roomRef, (snapshot) => {
        const rooms = snapshot.val();
        roomList.innerHTML = ""; // Clear the list

        if (rooms) {
          Object.keys(rooms).forEach((key) => {
            const room = rooms[key];
            const roomDiv = document.createElement("div");
            roomDiv.className = "room-entry";
            roomDiv.textContent = `${room.game} - ${room.players} players`;
            roomDiv.onclick = () => joinRoom(key);
            roomList.appendChild(roomDiv);
          });
        } else {
          roomList.innerHTML = "No rooms available.";
        }
      });
    }

    // Join a room
    function joinRoom(roomId) {
      alert(`Joining room: ${roomId}`);
      // Redirect to overlay or game page
      window.location.href = `overlay.html?room=${roomId}`;
    }

    // Initial load
    loadRooms();
  </script>
</body>
</html>
